<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SVLN SOLUTIONS Invoice</title>

<style>
body{
  font-family:Arial,Helvetica,sans-serif;
  background:#eee;
}
.invoice{
  width:820px;
  margin:20px auto;
  background:#fff;
  box-shadow:0 0 20px rgba(0,0,0,.3);
}
@media print{
  *{-webkit-print-color-adjust:exact;print-color-adjust:exact;}
  body{background:#fff}
  .no-print{display:none}
}

/* HEADER */
.header{
  background:linear-gradient(135deg,#111 60%,#c60000 60%);
  color:#fff;
  padding:20px;
}
.header h2{margin:0}
.header small{font-size:13px}

/* INFO */
.info{
  display:flex;
  justify-content:space-between;
  padding:15px;
  font-size:14px;
}
.info div{line-height:1.6}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
}
th{
  background:#c60000;
  color:#fff;
  padding:8px;
}
td{
  border:1px solid #aaa;
  padding:7px;
  text-align:center;
}
.left{text-align:left}

/* TOTAL */
.total{
  padding:15px;
  text-align:right;
  font-size:16px;
}

/* TERMS */
.terms{
  padding:15px;
  font-size:13px;
}
.terms h4{
  margin-bottom:5px;
  color:#c60000;
}

/* FOOTER */
.footer{
  background:#c60000;
  color:#fff;
  text-align:center;
  padding:10px;
  font-size:14px;
}

/* BUTTONS */
.btn{
  background:#111;
  color:#fff;
  border:none;
  padding:8px 16px;
  margin:4px;
  cursor:pointer;
  transition:.3s;
}
.btn:hover{
  transform:scale(1.08);
  opacity:.9;
}
</style>
</head>

<body>

<div class="invoice">

<!-- HEADER -->
<div class="header">
  <h2>SVLN SOLUTIONS</h2>
  <small>
    Laptop & Mobile Sales | Accessories | Service Center<br>
    5-33, Gold Market Street, Pithapuram ‚Äì 533450<br>
    üìû 9533330347, 9494488885
  </small>
</div>

<!-- CUSTOMER + INVOICE INFO -->
<div class="info">
  <div>
    <b>Bill To:</b><br>
    Name : <span id="cnameText">‚Äî</span><br>
    Mobile : <span id="cmobileText">‚Äî</span><br>
    Address : <span id="caddrText">‚Äî</span>
  </div>
  <div style="text-align:right">
    <b>Invoice No:</b> <span id="billno">‚Äî</span><br>
    <b>Date:</b> <span id="billdate"></span>
  </div>
</div>

<!-- ENTRY (HIDDEN IN PRINT) -->
<div class="no-print" style="padding:15px">
  Mobile:
  <input id="mobile" onblur="fetchCustomer()">
  Name:
  <input id="cname">
  Address:
  <input id="caddr" style="width:300px"><br><br>

  <select id="item"></select>
  Qty <input id="qty" type="number" value="1" style="width:60px">
  Rate <input id="price" style="width:80px">
  <button class="btn" onclick="addItem()">Add Item</button>
</div>

<!-- ITEMS TABLE -->
<table id="bill">
<thead>
<tr>
  <th>#</th>
  <th class="left">Item Description</th>
  <th>Rate</th>
  <th>Qty</th>
  <th>Total</th>
</tr>
</thead>
<tbody></tbody>
</table>

<!-- TOTAL -->
<div class="total">
  <b>Grand Total: ‚Çπ <span id="grand">0</span></b><br>
  Paid: ‚Çπ <input id="paid" type="number" value="0" style="width:90px"><br>
  <b>Balance Due: ‚Çπ <span id="due">0</span></b>
</div>

<!-- TERMS -->
<div class="terms">
  <h4>Terms & Conditions</h4>
  ‚Ä¢ Goods once sold will not be taken back.<br>
  ‚Ä¢ Accessories warranty as per manufacturer only.<br>
  ‚Ä¢ Service warranty limited to the reported issue only.<br>
  ‚Ä¢ Physical or liquid damage not covered under warranty.<br>
  ‚Ä¢ Please preserve this bill for warranty purpose.
</div>

<!-- ACTIONS -->
<div class="no-print" style="text-align:center;padding-bottom:10px">
  <button class="btn" onclick="saveBill()">Generate Bill</button>
  <button class="btn" onclick="sendWA()">WhatsApp</button>
  <button class="btn" onclick="window.print()">Print</button>
</div>

<!-- FOOTER -->
<div class="footer">
  Thank you for your business ‚Äì Visit Again üôè
</div>

</div>

<script>
const API="https://script.google.com/macros/s/AKfycbzgjTvvG9kJxl294NT-rQONzNwZL-aHcO8Ygicg3ylZdnmI6bZ8qs-LzYF4gkAb7MiRDg/exec";

billdate.innerText=new Date().toLocaleDateString();
let items=[], sno=1, grandTotal=0;

/* LOAD PRODUCTS */
fetch(API+"?action=products")
.then(r=>r.json())
.then(d=>{
 d.forEach(p=>{
  let o=document.createElement("option");
  o.value=p[0];
  o.text=p[1];
  o.dataset.price=p[3];
  item.appendChild(o);
 });
 price.value=item.options[0].dataset.price;
});
item.onchange=()=>price.value=item.options[item.selectedIndex].dataset.price;

/* CUSTOMER FETCH */
function fetchCustomer(){
 fetch(API+"?action=getCustomer&mobile="+mobile.value)
 .then(r=>r.text())
 .then(n=>{
  if(n) cname.value=n;
  updateCustomerView();
 });
}

/* ADD ITEM */
function addItem(){
 let q=+qty.value;
 let p=+price.value;
 let t=q*p;
 grandTotal+=t;

 items.push({code:item.value,qty:q,price:p});

 let r=bill.tBodies[0].insertRow();
 r.insertCell(0).innerText=sno++;
 r.insertCell(1).innerText=item.options[item.selectedIndex].text;
 r.insertCell(2).innerText=p;
 r.insertCell(3).innerText=q;
 r.insertCell(4).innerText=t;

 updateTotals();
}

paid.oninput=updateTotals;
function updateTotals(){
 grand.innerText=grandTotal;
 due.innerText=grandTotal-(+paid.value||0);
 updateCustomerView();
}

/* UPDATE CUSTOMER DISPLAY */
function updateCustomerView(){
 cnameText.innerText=cname.value||"‚Äî";
 cmobileText.innerText=mobile.value||"‚Äî";
 caddrText.innerText=caddr.value||"‚Äî";
}

/* SAVE BILL */
function saveBill(){
 fetch(API+"?action=sell"+
 "&items="+encodeURIComponent(JSON.stringify(items))+
 "&cname="+encodeURIComponent(cname.value)+
 "&mobile="+encodeURIComponent(mobile.value)+
 "&paid="+paid.value)
 .then(r=>r.text())
 .then(b=>{
  billno.innerText=b;
  alert("Invoice Generated: "+b);
 });
}

/* WHATSAPP */
function sendWA(){
 let msg=
`SVLN SOLUTIONS
Invoice: ${billno.innerText}
Customer: ${cname.value}
Mobile: ${mobile.value}

Items:
`;
 items.forEach(i=>{
  msg+=`${i.qty} x ${i.code} = ‚Çπ${i.qty*i.price}\n`;
 });
 msg+=`
Total: ‚Çπ${grandTotal}
Paid: ‚Çπ${paid.value}
Due: ‚Çπ${due.innerText}

SVLN SOLUTIONS
üìû 9533330347, 9494488885
Thank you for visiting`;

 window.open("https://wa.me/91"+mobile.value+"?text="+encodeURIComponent(msg));
}
</script>

</body>
</html>
