<!DOCTYPE html>
<html>
<head>
<title>SVLN Solutions â€“ Invoice</title>

<style>
body{font-family:Arial;background:#f2f2f2;}
.invoice{width:210mm;margin:auto;background:#fff;padding:20px;}
.header{display:flex;justify-content:space-between;border-bottom:2px solid #1f4fd8;padding-bottom:10px;}
.shop h2{margin:0;color:#1f4fd8;}
.shop{font-size:14px;}
.invoice-info{text-align:right;font-size:14px;}
.invoice-info b{color:#1f4fd8;}
.billto{margin-top:15px;font-size:14px;}
.table{width:100%;border-collapse:collapse;margin-top:15px;}
.table th{background:#1f4fd8;color:#fff;padding:8px;}
.table td{border:1px solid #ccc;padding:8px;text-align:center;}
.right{width:40%;float:right;margin-top:15px;}
.right td{border:1px solid #ccc;padding:8px;}
.words{margin-top:10px;font-size:14px;}
.sign{text-align:right;margin-top:40px;font-size:14px;}
.no-print{}
.print-text{display:none;}
input,select{width:100%;padding:5px;}
button{padding:8px 14px;margin-top:10px;}

@media print{
  body{background:#fff;}
  .no-print,input,select,button{display:none!important;}
  .print-text{display:inline!important;}
}
</style>
</head>

<body>

<div class="invoice">

<div class="header">
  <div class="shop">
    <h2>SVLN Solutions</h2>
    Gold Market Street, Pithapuram â€“ 533450<br>
    ðŸ“ž 9533330347, 9494488885
  </div>
  <div class="invoice-info">
    <b>INVOICE</b><br><br>
    Invoice No: <b id="billno" class="print-text"></b><br>
    Date: <span id="bdate"></span>
  </div>
</div>

<div class="billto">
<b>Bill To:</b><br>
<span id="pcname" class="print-text"></span>
<input id="cname" class="no-print" placeholder="Customer Name"><br>
Ph:
<span id="pmobile" class="print-text"></span>
<input id="mobile" class="no-print" placeholder="Mobile" onblur="fetchCustomer()">
</div>

<table class="table no-print">
<tr><th>Item</th><th>Qty</th><th>Rate</th><th>Amount</th><th></th></tr>
<tr>
<td><select id="item"></select></td>
<td><input id="qty" type="number" value="1"></td>
<td><input id="price"></td>
<td id="amt">0</td>
<td><button onclick="addItem()">Add</button></td>
</tr>
</table>

<table class="table" id="billTable">
<tr><th>#</th><th>Item</th><th>Rate</th><th>Qty</th><th>Amount</th></tr>
</table>

<table class="right">
<tr><td>Total</td><td id="total">0</td></tr>
<tr>
<td>GST % <span class="print-text" id="pgst"></span>
<input id="gstp" class="no-print" value="18" oninput="calcTotal()">
</td>
<td id="gst">0</td>
</tr>
<tr><td><b>Amount Payable</b></td><td><b id="grand">0</b></td></tr>
</table>

<div style="clear:both"></div>

<div class="words">
<b>Amount in Words:</b> <span id="words"></span>
</div>

<div class="sign">
For <b>SVLN Solutions</b><br><br>
Authorized Signatory
</div>

<div style="text-align:center;margin-top:15px;font-weight:bold;">
Thank you for doing business with us!
</div>

<button class="no-print" onclick="saveBill()">Generate Invoice</button>
<button class="no-print" onclick="window.print()">Print</button>
<button class="no-print" onclick="sendWhatsApp()">Send WhatsApp</button>

</div>

<script>
const API="https://script.google.com/macros/s/AKfycbwpbLtM6zx961KO8OD2N6RCe_kFxKH6vcL3bVelxv70QnzBz1YNzdCcgGAyMRpV8wGHWg/exec";

bdate.innerText=new Date().toLocaleDateString();
let billItems=[],total=0,sno=1;

/* LOAD PRODUCTS */
fetch(API+"?action=products")
.then(r=>r.json())
.then(d=>{
 d.forEach(p=>{
  let o=document.createElement("option");
  o.value=p[0]; o.text=p[1]; o.dataset.price=p[3];
  item.appendChild(o);
 });
 price.value=item.options[0].dataset.price;
 calcAmt();
});

/* AUTO FETCH CUSTOMER */
function fetchCustomer(){
 if(mobile.value.length<10) return;
 fetch(API+"?action=getCustomer&mobile="+mobile.value)
 .then(r=>r.text())
 .then(name=>{ if(name) cname.value=name; });
}

/* CALC */
function calcAmt(){ amt.innerText=(qty.value*price.value).toFixed(2); }
qty.oninput=calcAmt; price.oninput=calcAmt;
item.onchange=()=>{price.value=item.options[item.selectedIndex].dataset.price;calcAmt();}

function addItem(){
 let q=Number(qty.value),p=Number(price.value);
 let a=q*p;
 billItems.push({code:item.value,qty:q});
 total+=a;
 let r=billTable.insertRow();
 r.insertCell(0).innerText=sno++;
 r.insertCell(1).innerText=item.options[item.selectedIndex].text;
 r.insertCell(2).innerText=p;
 r.insertCell(3).innerText=q;
 r.insertCell(4).innerText=a;
 calcTotal();
}

function calcTotal(){
 let g=total*gstp.value/100;
 totalEl.innerText=total.toFixed(2);
 gst.innerText=g.toFixed(2);
 grand.innerText=(total+g).toFixed(2);
 pgst.innerText=gstp.value+"%";
 words.innerText=numWords(Math.round(total+g));
}

function numWords(n){
 const a=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten",
 "Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"];
 const b=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];
 if(n<20)return "INR "+a[n]+" Only";
 if(n<100)return "INR "+b[Math.floor(n/10)]+" "+a[n%10]+" Only";
 if(n<1000)return "INR "+a[Math.floor(n/100)]+" Hundred "+numWords(n%100);
 return "INR "+numWords(Math.floor(n/1000))+" Thousand "+numWords(n%1000);
}

function saveBill(){
