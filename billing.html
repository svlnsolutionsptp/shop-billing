<!DOCTYPE html>
<html>
<head>
<title>SVLN Billing</title>
<style>
body{font-family:Arial;background:#f4f6fb}
table{border-collapse:collapse;width:100%;background:#fff}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#1f4fd8;color:#fff}
button{padding:8px 14px;background:#1f4fd8;color:#fff;border:none}
button:active{transform:scale(.95);opacity:.8}
</style>
</head>
<body>

<h3>SVLN SOLUTIONS â€“ Billing</h3>

<input id="cname" placeholder="Customer Name">
<input id="mobile" placeholder="Mobile"><br><br>

<select id="item"></select>
<input id="qty" type="number" value="1">
<input id="price">
<input id="gst" value="18">
<button onclick="addItem()">Add</button>

<table id="bill">
<tr>
<th>#</th><th>Item</th><th>Qty</th><th>Rate</th><th>GST%</th><th>Total</th>
</tr>
</table>

<button onclick="saveBill()">Save Bill</button>

<script>
const API="https://script.google.com/macros/s/AKfycbwrbXi8XyrsB5r44iVS1z6hhF36NZgxjdAF2h0RIIM1XsI6BzspNgIhQEUK1c-IWZgD_w/exec";

let billItems=[];
let sno=1;

fetch(API+"?action=products")
.then(r=>r.json())
.then(d=>{
  d.forEach(p=>{
    let o=document.createElement("option");
    o.value=p[0];
    o.text=p[1];
    o.dataset.price=p[3];   // selling price
    item.appendChild(o);
  });
  price.value=item.options[0].dataset.price;
});

item.onchange=()=>{
  price.value=item.options[item.selectedIndex].dataset.price;
};

function addItem(){
  let q=Number(qty.value);
  let p=Number(price.value);
  let g=Number(gst.value);

  let total=(q*p)+(q*p*g/100);

  billItems.push({
    code:item.value,
    qty:q,
    price:p,   // ðŸ”´ ACTUAL PRICE
    gst:g
  });

  let r=bill.insertRow();
  r.insertCell(0).innerText=sno++;
  r.insertCell(1).innerText=item.options[item.selectedIndex].text;
  r.insertCell(2).innerText=q;
  r.insertCell(3).innerText=p;
  r.insertCell(4).innerText=g;
  r.insertCell(5).innerText=total.toFixed(2);
}

function saveBill(){
  fetch(API+"?action=sell"+
    "&items="+encodeURIComponent(JSON.stringify(billItems))+
    "&cname="+encodeURIComponent(cname.value)+
    "&mobile="+encodeURIComponent(mobile.value)
  )
  .then(r=>r.text())
  .then(b=>{
    alert("Bill Saved: "+b);
    setTimeout(()=>window.print(),500);
  });
}
</script>

</body>
</html>
