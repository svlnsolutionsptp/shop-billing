<!DOCTYPE html>
<html>
<head>
<title>SVLN SOLUTIONS - GST BILL</title>

<style>
body{font-family:Arial;background:#eee;}
.bill{width:210mm;margin:auto;background:#fff;padding:20px;}

h1{text-align:center;color:#0a4da3;margin:5px;}
.shop{text-align:center;font-size:14px;}

table{width:100%;border-collapse:collapse;margin-top:10px;}
th{background:#0a4da3;color:#fff;padding:6px;}
td{border:1px solid #000;padding:6px;text-align:center;}

input,select{width:100%;padding:5px;}
.total-box{width:40%;float:right;}
.footer{text-align:center;margin-top:30px;font-weight:bold;}

@media print{
button{display:none;}
body{background:#fff;}
}
</style>
</head>

<body>

<div class="bill">

<h1>SVLN SOLUTIONS</h1>
<div class="shop">
5-33, Gold Market Street, Pithapuram, Andhra Pradesh<br>
PIN: 533450<br>
üìû 9533330347, 9494488885
</div>

<hr>

<table>
<tr>
<td>Bill Date: <b id="bdate"></b></td>
<td>Customer: <input id="cname"></td>
<td>Mobile: <input id="mobile"></td>
</tr>
</table>

<table>
<tr>
<th>Item</th>
<th>Qty</th>
<th>Price</th>
<th>Amount</th>
<th></th>
</tr>
<tr>
<td><select id="item"></select></td>
<td><input id="qty" type="number" value="1"></td>
<td><input id="price"></td>
<td id="amt">0</td>
<td><button onclick="addItem()">Add</button></td>
</tr>
</table>

<table id="billTable">
<tr>
<th>S.No</th><th>Item</th><th>Qty</th><th>Price</th><th>Amount</th>
</tr>
</table>

<table class="total-box">
<tr><td>Total</td><td id="total">0</td></tr>
<tr>
<td>GST % <input id="gstp" value="18" oninput="calc()"></td>
<td id="gst">0</td>
</tr>
<tr><td>Grand</td><td id="grand">0</td></tr>
</table>

<br style="clear:both">

<button onclick="saveBill()">Generate Bill</button>
<button onclick="window.print()">Print</button>

<div class="footer">
üôè Thank you ‚Äì Visit Again üôè
</div>

</div>

<script>
const API="PASTE_NEW_APPS_SCRIPT_URL";

document.getElementById("bdate").innerText =
  new Date().toLocaleDateString();

let products=[];
let billItems=[];
let total=0;
let sno=1;

/* LOAD PRODUCTS */
fetch(API+"?action=products")
.then(r=>r.json())
.then(data=>{
  products=data;
  data.forEach(p=>{
    let o=document.createElement("option");
    o.value=p[0];
    o.text=p[0]+" - "+p[1];
    o.dataset.price=p[3];
    item.appendChild(o);
  });
  price.value=item.options[0].dataset.price;
  calcAmt();
});

/* AUTO PRICE */
item.onchange=()=>{
  price.value=item.options[item.selectedIndex].dataset.price;
  calcAmt();
};
qty.oninput=calcAmt;
price.oninput=calcAmt;

function calcAmt(){
  amt.innerText=(qty.value*price.value).toFixed(2);
}

function addItem(){
  let code=item.value;
  let name=item.options[item.selectedIndex].text;
  let q=Number(qty.value);
  let p=Number(price.value);
  let a=q*p;

  billItems.push({code:code,qty:q});
  total+=a;

  let r=billTable.insertRow();
  r.insertCell(0).innerText=sno++;
  r.insertCell(1).innerText=name;
  r.insertCell(2).innerText=q;
  r.insertCell(3).innerText=p;
  r.insertCell(4).innerText=a;

  calc();
}

function calc(){
  let g=total*Number(gstp.value)/100;
  totalEl.innerText=total.toFixed(2);
  gst.innerText=g.toFixed(2);
  grand.innerText=(total+g).toFixed(2);
}

function saveBill(){
  if(billItems.length==0){
    alert("Add items first");
    return;
  }
  let url=API+
   "?action=sell"+
   "&items="+encodeURIComponent(JSON.stringify(billItems))+
   "&cname="+encodeURIComponent(cname.value)+
   "&mobile="+encodeURIComponent(mobile.value);

  fetch(url)
  .then(r=>r.text())
  .then(t=>{
    alert("Bill Saved: "+t);
    location.reload();
  });
}

const totalEl=document.getElementById("total");
</script>

</body>
</html>
