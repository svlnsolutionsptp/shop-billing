<!DOCTYPE html>
<html>
<head>
<title>Billing</title>

<style>
body{font-family:Arial;background:#eee;}
.bill{width:210mm;margin:auto;background:#fff;padding:20px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #000;padding:6px;text-align:center;}
th{background:#0a4da3;color:#fff;}
input,select{width:100%;padding:5px;}
.no-print{}
.print-text{display:none;}
@media print{
 input,select,button,.no-print{display:none!important;}
 .print-text{display:inline!important;}
}
</style>
</head>

<body>
<div class="bill">

<h2 style="text-align:center">SVLN SOLUTIONS</h2>

<table>
<tr>
<td>Bill No: <b id="billno" class="print-text"></b></td>
<td>Date: <b id="bdate"></b></td>
<td>
Customer:
<span id="pcname" class="print-text"></span>
<input id="cname" class="no-print">
</td>
<td>
Mobile:
<span id="pmobile" class="print-text"></span>
<input id="mobile" class="no-print">
</td>
</tr>
</table>

<table>
<tr>
<th>Item</th><th>Qty</th><th>Price</th><th>Amount</th><th class="no-print"></th>
</tr>
<tr class="no-print">
<td><select id="item"></select></td>
<td><input id="qty" value="1"></td>
<td><input id="price"></td>
<td id="amt">0</td>
<td><button onclick="addItem()">Add</button></td>
</tr>
</table>

<table id="billTable">
<tr><th>SNo</th><th>Item</th><th>Qty</th><th>Price</th><th>Amount</th></tr>
</table>

<button class="no-print" onclick="saveBill()">Generate Bill</button>
<button class="no-print" onclick="window.print()">Print</button>

</div>

<script>
const API="https://script.google.com/macros/s/AKfycbymUAdMOAvEnqQGCoX7EAsDwc-MUO0nWa8vysZCuWMAJTYRcUxCFYjNMJqxLPRTXQtngg/exec";
bdate.innerText=new Date().toLocaleDateString();
let billItems=[],total=0,sno=1;

fetch(API+"?action=products")
.then(r=>r.json())
.then(d=>{
 d.forEach(p=>{
  let o=document.createElement("option");
  o.value=p[0]; o.text=p[1]; o.dataset.price=p[3];
  item.appendChild(o);
 });
 price.value=item.options[0].dataset.price;
 calc();
});

function calc(){ amt.innerText=(qty.value*price.value).toFixed(2); }
qty.oninput=calc; price.oninput=calc;
item.onchange=()=>{price.value=item.options[item.selectedIndex].dataset.price;calc();}

function addItem(){
 let q=Number(qty.value), p=Number(price.value);
 let a=q*p;
 billItems.push({code:item.value,qty:q});
 let r=billTable.insertRow();
 r.insertCell(0).innerText=sno++;
 r.insertCell(1).innerText=item.options[item.selectedIndex].text;
 r.insertCell(2).innerText=q;
 r.insertCell(3).innerText=p;
 r.insertCell(4).innerText=a;
}

function saveBill(){
 if(!cname.value||mobile.value.length<10){alert("Customer details");return;}
 pcname.innerText=cname.value; pmobile.innerText=mobile.value;

 fetch(API+"?action=sell"+
 "&items="+encodeURIComponent(JSON.stringify(billItems))+
 "&cname="+encodeURIComponent(cname.value)+
 "&mobile="+encodeURIComponent(mobile.value))
 .then(r=>r.text())
 .then(bn=>{ billno.innerText=bn; alert("Saved "+bn); });
}
</script>

</body>
</html>
