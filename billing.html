<!DOCTYPE html>
<html>
<head>
<title>Billing</title>
<style>
body{font-family:Arial;background:#eceff1}
@media print{
 *{-webkit-print-color-adjust:exact}
 .no-print{display:none}
}
.invoice{
 width:820px;
 margin:auto;
 background:#fff;
 border-radius:18px;
 box-shadow:0 15px 40px rgba(0,0,0,.25);
 overflow:hidden;
}
.header{
 background:linear-gradient(135deg,#ff416c,#ff4b2b);
 color:#fff;
 padding:20px;
}
.header h2{margin:0}
.section{padding:15px}
table{width:100%;border-collapse:collapse}
th{
 background:#ff416c;
 color:#fff;
 padding:8px;
}
td{
 border:1px solid #ddd;
 padding:6px;
 text-align:center;
}
.btn{
 background:linear-gradient(135deg,#36d1dc,#5b86e5);
 color:#fff;
 border:none;
 padding:10px 18px;
 border-radius:12px;
 cursor:pointer;
 transition:.3s;
}
.btn:hover{transform:scale(1.05)}
.footer{
 background:#ff416c;
 color:#fff;
 text-align:center;
 padding:10px;
}
</style>
</head>
<body>

<div class="invoice">

<div class="header">
<h2>SVLN SOLUTIONS</h2>
5-33 Gold Market Street, Pithapuram<br>
üìû 9533330347, 9494488885
</div>

<div class="section">
Mobile <input id="m" onblur="cust()">
Name <input id="n"><br><br>

<select id="i"></select>
Qty <input id="q" value="1" style="width:60px">
Rate <input id="r" style="width:80px">
<button class="btn no-print" onclick="add()">Add</button>
</div>

<table id="t">
<tr><th>Item</th><th>Qty</th><th>Total</th></tr>
</table>

<div class="section" style="text-align:right">
<h3>Total ‚Çπ <span id="gt">0</span></h3>
Paid <input id="p" value="0"><br>
<b>Due ‚Çπ <span id="d">0</span></b>
</div>

<div class="section no-print" style="text-align:center">
<button class="btn" onclick="save()">Save</button>
<button class="btn" onclick="wa()">WhatsApp</button>
<button class="btn" onclick="window.print()">Print</button>
</div>

<div class="footer">Thank you ‚Äì Visit Again üôè</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbzgjTvvG9kJxl294NT-rQONzNwZL-aHcO8Ygicg3ylZdnmI6bZ8qs-LzYF4gkAb7MiRDg/exec";
let items=[],gt=0;

fetch(API+"?action=products")
.then(r=>r.json())
.then(d=>{
 d.forEach(x=>i.innerHTML+=`<option value=${x[0]} data-p=${x[3]}>${x[1]}</option>`);
 r.value=i.selectedOptions[0].dataset.p;
});
i.onchange=()=>r.value=i.selectedOptions[0].dataset.p;

function cust(){
 fetch(API+"?action=getCustomer&mobile="+m.value)
 .then(r=>r.text()).then(x=>n.value=x);
}

function add(){
 let tot=q.value*r.value;
 gt+=Number(tot);
 items.push({code:i.value,qty:q.value,price:r.value});
 t.innerHTML+=`<tr><td>${i.selectedOptions[0].text}</td><td>${q.value}</td><td>${tot}</td></tr>`;
 gtEl.innerText=gt;
 d.innerText=gt-(+p.value||0);
}
p.oninput=()=>d.innerText=gt-(+p.value||0);

function save(){
 fetch(API+"?action=sell&items="+encodeURIComponent(JSON.stringify(items))+
 "&cname="+n.value+"&mobile="+m.value+"&paid="+p.value)
 .then(r=>r.text()).then(b=>alert("Bill "+b));
}

function wa(){
 let msg="SVLN SOLUTIONS BILL\n";
 items.forEach(x=>msg+=`${x.qty} x ${x.code} = ‚Çπ${x.qty*x.price}\n`);
 msg+="Total ‚Çπ"+gt;
 open("https://wa.me/91"+m.value+"?text="+encodeURIComponent(msg));
}

const gtEl=document.getElementById("gt");
</script>

</body>
</html>
